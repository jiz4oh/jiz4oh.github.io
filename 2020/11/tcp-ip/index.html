<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arial:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"jiz4oh.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="前言最近在极客时间学习刘超老师的趣谈网络协议，对 TCP&#x2F;IP 有了更深的了解与感触，记录下学习的心得与体会"><meta property="og:type" content="article"><meta property="og:title" content="TCP&#x2F;IP 五层协议"><meta property="og:url" content="http://jiz4oh.com/2020/11/tcp-ip/index.html"><meta property="og:site_name" content="Jiz4oh&#39;s Life"><meta property="og:description" content="前言最近在极客时间学习刘超老师的趣谈网络协议，对 TCP&#x2F;IP 有了更深的了解与感触，记录下学习的心得与体会"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-08-06-50-40.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-16-00.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-24-39.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-44-19.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-52-00.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-54-49.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-55-22.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-58-41.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-59-00.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-01-23.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-03-23.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-10-06.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-11-16.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-25-18.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-32-03.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-10-04-28.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-18-26-14.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-18-39-47.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-19-12-26.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-19-56-04.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/%E7%BD%91%E7%BB%9C-20200913222940.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200914080034.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200914075917.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916211417.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916211957.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916230544.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916231334.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916231723.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200917075642.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E6%9E%84%E6%88%90.png"><meta property="og:image" content="https://static001.geekbang.org/resource/image/99/49/99c282efaca15deb79c7821c9c577349.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920011230.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920161444.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920224427.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920225045.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920230522.png"><meta property="og:image" content="https://static001.geekbang.org/resource/image/79/aa/79adec391c62b8cf90c210804b704daa.jpg"><meta property="og:image" content="https://img-blog.csdn.net/2018041112053246?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTIxNTU0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><meta property="article:published_time" content="2020-11-08T12:58:08.000Z"><meta property="article:modified_time" content="2020-11-08T12:58:08.000Z"><meta property="article:author" content="jiz4oh"><meta property="article:tag" content="think"><meta property="article:tag" content="study"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-08-06-50-40.png"><link rel="canonical" href="http://jiz4oh.com/2020/11/tcp-ip/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://jiz4oh.com/2020/11/tcp-ip/","path":"2020/11/tcp-ip/","title":"TCP/IP 五层协议"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>TCP/IP 五层协议 | Jiz4oh's Life</title><script async defer data-website-id="" src=""></script><script defer data-domain="" src=""></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1297217754235608" crossorigin="anonymous"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Jiz4oh's Life</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-TCP-IP-%E4%BA%94%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.1.</span> <span class="nav-text">什么是 TCP&#x2F;IP 五层协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E7%90%86%E5%B1%82"><span class="nav-number">2.</span> <span class="nav-text">物理层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82"><span class="nav-number">3.</span> <span class="nav-text">数据链路层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MAC-%E5%9C%B0%E5%9D%80"><span class="nav-number">3.1.</span> <span class="nav-text">MAC 地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="nav-number">3.2.</span> <span class="nav-text">交换机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ARP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">3.3.</span> <span class="nav-text">ARP 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ARP-%E8%A1%A8"><span class="nav-number">3.3.1.</span> <span class="nav-text">ARP 表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RARP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">3.4.</span> <span class="nav-text">RARP 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91%E8%A1%A8"><span class="nav-number">3.5.</span> <span class="nav-text">转发表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84"><span class="nav-number">3.6.</span> <span class="nav-text">拓扑结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#STP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">3.7.</span> <span class="nav-text">STP 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VLAN"><span class="nav-number">3.8.</span> <span class="nav-text">VLAN</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="nav-number">4.</span> <span class="nav-text">网络层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ICMP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">4.1.</span> <span class="nav-text">ICMP 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%8A%A5%E6%96%87"><span class="nav-number">4.1.1.</span> <span class="nav-text">查询报文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%AE%E9%94%99%E6%8A%A5%E6%96%87"><span class="nav-number">4.1.2.</span> <span class="nav-text">差错报文</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E5%85%B3"><span class="nav-number">4.2.</span> <span class="nav-text">网关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%92%8C%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">4.2.1.</span> <span class="nav-text">和路由器的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1"><span class="nav-number">4.2.2.</span> <span class="nav-text">静态路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="nav-number">4.2.3.</span> <span class="nav-text">动态路由</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="nav-number">5.</span> <span class="nav-text">传输层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UDP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">5.1.</span> <span class="nav-text">UDP 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">5.2.</span> <span class="nav-text">TCP 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="nav-number">5.2.1.</span> <span class="nav-text">TCP 状态机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%AF%E8%AE%A1%E5%BA%94%E7%AD%94"><span class="nav-number">5.2.2.</span> <span class="nav-text">累计应答</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A1%AE%E8%AE%A4%E4%B8%8E%E9%87%8D%E5%8F%91%E6%9C%BA%E5%88%B6"><span class="nav-number">5.2.3.</span> <span class="nav-text">确认与重发机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="nav-number">5.2.4.</span> <span class="nav-text">流量控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="nav-number">5.2.5.</span> <span class="nav-text">拥塞控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BBR-%E7%AE%97%E6%B3%95"><span class="nav-number">5.2.6.</span> <span class="nav-text">BBR 算法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Socket-%E6%8E%A5%E5%8F%A3"><span class="nav-number">5.3.</span> <span class="nav-text">Socket 接口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-TCP-%E5%8D%8F%E8%AE%AE%E7%9A%84-Socket"><span class="nav-number">5.3.1.</span> <span class="nav-text">基于 TCP 协议的 Socket</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-UDP-%E5%8D%8F%E8%AE%AE%E7%9A%84-Socket"><span class="nav-number">5.3.2.</span> <span class="nav-text">基于 UDP 协议的 Socket</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%A4%84%E7%90%86-scoket-%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F"><span class="nav-number">5.3.3.</span> <span class="nav-text">应用处理 scoket 连接方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82"><span class="nav-number">6.</span> <span class="nav-text">应用层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.1.</span> <span class="nav-text">DHCP 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.2.</span> <span class="nav-text">HTTP 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP-2-0"><span class="nav-number">6.2.1.</span> <span class="nav-text">HTTP 2.0</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QUIC-%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.3.</span> <span class="nav-text">QUIC 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPS-%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.4.</span> <span class="nav-text">HTTPS 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS-%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.5.</span> <span class="nav-text">DNS 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPDNS-%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.6.</span> <span class="nav-text">HTTPDNS 协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">7.</span> <span class="nav-text">参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="jiz4oh" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">jiz4oh</p><div class="site-description" itemprop="description">莫见乎隐，莫显乎微，故君子慎其独也</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">26</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="cc-license animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://jiz4oh.com/2020/11/tcp-ip/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="jiz4oh"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jiz4oh's Life"><meta itemprop="description" content="莫见乎隐，莫显乎微，故君子慎其独也"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="TCP/IP 五层协议 | Jiz4oh's Life"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">TCP/IP 五层协议</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-11-08 20:58:08" itemprop="dateCreated datePublished" datetime="2020-11-08T20:58:08+08:00">2020-11-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">网络</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>10k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>19 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在极客时间学习刘超老师的<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/85">趣谈网络协议</a>，对 TCP/IP 有了更深的了解与感触，记录下学习的心得与体会</p><span id="more"></span><h3 id="什么是-TCP-IP-五层协议"><a href="#什么是-TCP-IP-五层协议" class="headerlink" title="什么是 TCP/IP 五层协议"></a>什么是 TCP/IP 五层协议</h3><p>TCP/IP 五层协议是在一定程度上参考了 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B">OSI 7层模型</a> 的体系结构，将 OSI 7层模型简化为了五层（也有将链路层和物理层合并后简化为四层的）</p><p>五层协议：应（应表会）传网数物</p><ul><li>应用层：HTTP,FTP 等协议<br>封装请求正文</li><li>传输层：TCP/UDP 协议<br>将端口信息（当前应用监听端口、目标应用监听端口）等封装</li><li>网络层：ICMP,IP 等协议<br>封装 IP 地址（当前主机 ip 地址、目标主机 ip 地址）</li><li>数据链路层：以太网等协议<br>封装 MAC 地址（当前主机的 MAC 地址、网关的 MAC 地址），通过 ARP 协议在局域网广播找到网关后，通过网关发送出去</li><li>物理层：<br>将数据转换为二进制，作为电信号发送出去</li></ul><p>五层协议中协议有哪些：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-08-06-50-40.png" alt="2020-09-08-06-50-40"></p><h2 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h2><p>物理层就是网线，中间传输的是光信号</p><p>两台电脑通过网线直接连接，就可以组成一个最小的 <strong>局域网</strong>，即 LAN，Local Area Network</p><p>如果多台电脑需要组成一个局域网，就需要一个设备来控制数据传输的目的地和先后顺序，比如交换机</p><h2 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h2><p>数据链路层包格式：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-16-00.png" alt="2020-09-12-17-16-00"></p><p>在数据链路层（MAC 层）需要解决 3 个问题：</p><ol><li>数据的先后顺序<br>MAC 层全称 Medium Access Control，即媒体访问控制。控制如何进行 <strong>多路访问</strong></li><li>数据的目的地<br>这就需要一个物理地址，叫作 <strong>链路层地址</strong>，也即 <strong>MAC 地址</strong></li><li>发送错误的处理方式<br>对于以太网，第二层的最后面是 <strong>CRC</strong>，也就是循环冗余检测。通过 XOR异或 的算法，来计算整个包是否在发送的过程中出现了错误</li></ol><h3 id="MAC-地址"><a href="#MAC-地址" class="headerlink" title="MAC 地址"></a>MAC 地址</h3><p>MAC 地址更像是身份证，是一个唯一的标识。它的唯一性设计是为了组网的时候，不同的网卡放在一个网络里面的时候，可以不用担心冲突。从硬件角度，保证不同的网卡有不同的标识。</p><p>MAC 地址的通信范围比较小，局限在一个子网里面。例如，从 192.168.0.2/24 访问 192.168.0.3/24 是可以用 MAC 地址的。一旦跨子网，即从 192.168.0.2/24 到 192.168.1.2/24，MAC 地址就不行了，需要 IP 地址起作用了</p><h3 id="交换机"><a href="#交换机" class="headerlink" title="交换机"></a>交换机</h3><p>交换机是二层转发设备，主要作用就是获取到网络包之后，检查包的目标 MAC 头，再根据策略进行转发，避免主机每次都进行广播发送网络包</p><h3 id="ARP-协议"><a href="#ARP-协议" class="headerlink" title="ARP 协议"></a>ARP 协议</h3><p>当局域网中如果有多台机器，知道目标 IP 地址而不知道 MAC 地址时，就需要使用 ARP 协议来获取。</p><blockquote><p>已知 IP 地址，求 MAC 地址的协议</p></blockquote><p>原理是向局域网发出 ARP 协议进行广播，等待目标主机回应</p><p>具体询问和回答的报文：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-24-39.png" alt="2020-09-12-17-24-39"></p><h4 id="ARP-表"><a href="#ARP-表" class="headerlink" title="ARP 表"></a>ARP 表</h4><p>主机不可能每次都通过 ARP 协议来广播查找 MAC 地址，这样会极大降低效率，所以当主机通过 ARP 协议获取了 MAC 地址之后，就会在本地缓存一个 ARP 表，存储 IP-MAC 的映射。</p><p>只有当 ARP 表没有对应的 MAC 地址时，主机才会通过 ARP 协议去获取 MAC 地址并更新 ARP 表</p><p>因为主机的 IP 和 MAC 可能会改变，所以 ARP 表是有过期时间的。</p><h3 id="RARP-协议"><a href="#RARP-协议" class="headerlink" title="RARP 协议"></a>RARP 协议</h3><p>RARP 协议即 Reverse ARP 协议</p><blockquote><p>已知 MAC 地址，求 IP 地址的协议</p></blockquote><h3 id="转发表"><a href="#转发表" class="headerlink" title="转发表"></a>转发表</h3><p>当源主机发出了数据报文之后，数据报文其实只知道 MAC 地址，而不知道具体路径，就像你要到一个地方去，但是你不知道如何去一样</p><p>当主机通过网线向连接的设备发送请求时</p><ol><li>设备为 hub 集线器：<br>hub 集线器是一层设备，只会简单的完全复制，会向所有非源设备广播转发请求，通过其他主机自己来确认数据包是否应该接受</li><li>设备为交换机：<br>交换机刚开始也不会知道所有主机的 MAC 地址，但是当 主机 A 发送一个请求到达交换机时，交换机会记录下该请求的主机的 MAC 地址，当有其他请求目标地址为主机 A 时，会只转发给主机A，不再进行广播。<br>然后过一段时间之后就会记录下局域网下所有主机的 MAC 地址，这个就是 <strong>转发表</strong></li></ol><p>因为主机的 MAC 可能会改变，所以转发表是有过期时间的。</p><h3 id="拓扑结构"><a href="#拓扑结构" class="headerlink" title="拓扑结构"></a>拓扑结构</h3><p>当局域网中主机过多，比如办公室场景，可能有几十几百个网口，这时候一个交换机是不够用的，就需要多台交换机，这时候交换机连接起来就是 <strong>拓扑结构</strong></p><p>当交换机过多时，不可避免的会出现 <strong>环路问题</strong>，例如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-44-19.png" alt="2020-09-12-17-44-19"></p><ol><li>当机器 1 发送 ARP 广播寻找机器 2 的 MAC 地址时，交换机 A 和交换机 B 都会收到这个广播，此时，都会记得 机器 1 是在左边这个网口</li><li>然后都同时向 LAN2 转发这条广播消息，当交换机 A 收到交换机 B 转发的消息时，会发现是机器 1 在寻找机器 2，这时候就会发现机器 1 位于右边这个网口，于是更新自己的记录，将这个消息转发到 LAN1。</li><li>同理，交换机 B 也会更新自己的记录，然后转发消息到 LAN1</li><li>然后这个广播请求会来回转发，就会堵塞网络</li></ol><p>这时候需要破除环路</p><h3 id="STP-协议"><a href="#STP-协议" class="headerlink" title="STP 协议"></a>STP 协议</h3><p>STP：Spanning Tree Protocol，是一个生成树的算法，用来破解环路</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-52-00.png" alt="2020-09-12-17-52-00"></p><ul><li><p><strong>Root Bridge</strong>，也就是根交换机。这个比较容易理解，可以比喻为“掌门”交换机，是某棵树的老大，是掌门，最大的大哥。</p></li><li><p><strong>Designated Bridges</strong>，有的翻译为指定交换机。这个比较难理解，可以想像成一个“小弟”，对于树来说，就是一棵树的树枝。所谓“指定”的意思是，我拜谁做大哥，其他交换机通过这个交换机到达根交换机，也就相当于拜他做了大哥。这里注意是树枝，不是叶子，因为叶子往往是主机。</p></li><li><p><strong>Bridge Protocol Data Units</strong> （BPDU） ，网桥协议数据单元。可以比喻为“相互比较实力”的协议。行走江湖，比的就是武功，拼的就是实力。当两个交换机碰见的时候，也就是相连的时候，就需要互相比一比内力了。BPDU只有掌门能发，已经隶属于某个掌门的交换机只能传达掌门的指示。</p></li><li><p><strong>Priority Vector</strong>，优先级向量。可以比喻为实力 （值越小越牛）。实力是啥？就是一组ID数目，[Root Bridge ID, Root Path Cost, Bridge ID, and Port ID]。为什么这样设计呢？这是因为要看怎么来比实力。先看Root Bridge ID。拿出老大的ID看看，发现掌门一样，那就是师兄弟；再比Root Path Cost，也即我距离我的老大的距离，也就是拿和掌门关系比，看同一个门派内谁和老大关系铁；最后比Bridge ID，比我自己的ID，拿自己的本事比。</p></li></ul><p>STP的工作过程是怎样的？</p><ol><li><p>一开始，江湖纷争，异常混乱。大家都觉得自己是掌门，谁也不服谁。于是，所有的交换机都认为自己是掌门，每个网桥都被分配了一个ID。这个ID里有管理员分配的优先级，当然网络管理员知道哪些交换机贵，哪些交换机好，就会给它们分配高的优先级。这种交换机生下来武功就很高，起步就是乔峰</p><p>(图中圆圈内数据代表优先级，线上数字代表传输距离，优先级越小越优先，距离越小越优先)</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-54-49.png" alt="2020-09-12-17-54-49"></p></li><li><p>既然都是掌门，互相都连着网线，就互相发送 BPDU 来比功夫呗。这一比就发现，有人是岳不群，有人是封不平，赢的接着当掌门，输的就只好做小弟了。当掌门的还会继续发 BPDU，而输的人就没有机会了。它们只有在收到掌门发的 BPDU 的时候，转发一下，表示服从命令。</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-55-22.png" alt="2020-09-12-17-55-22"></p><p>数字表示优先级。就像这个图，5 和 6 碰见了，6 的优先级低，所以乖乖做小弟。于是一个小门派形成，5 是掌门，6 是小弟。其他诸如 1-7、2-8、3-4 这样的小门派，也诞生了。于是江湖出现了很多小的门派，小的门派，接着合并。</p><p>合并的过程根据传输距离会出现以下<strong>四种情形</strong></p><ol><li><p>情形一：掌门遇到掌门<br>当 5 碰到了 1，掌门碰见掌门，1 觉得自己是掌门，5 也刚刚跟别人PK完成为掌门。这俩掌门比较功夫，最终 1 胜出。于是输掉的掌门 5 就会率领所有的小弟归顺。结果就是 1 成为大掌门。</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-58-41.png" alt="2020-09-12-17-58-41"></p></li><li><p>情形二：同门相遇<br>同门相遇可以是掌门与自己的小弟相遇，这说明存在“环”了。这个小弟已经通过其他门路拜在你门下，结果你还不认识，就 PK 了一把。结果掌门发现这个小弟功夫不错，不应该级别这么低，就把它招到门下亲自带，那这个小弟就相当于升职了。</p><p>我们再来看，假如 1 和 6 相遇。6 原来就拜在 1 的门下，只不过 6 的上司是 5，5 的上司是 1。1 发现，6 距离我才只有 2，比从 5 这里过来的 5（=4+1）近多了，那 6 就直接汇报给我吧。于是，5 和 6 分别汇报给 1。</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-17-59-00.png" alt="2020-09-12-17-59-00"></p></li><li><p>情形三：掌门与其他帮派小弟相遇<br>小弟拿本帮掌门和这个掌门比较，赢了，这个掌门拜入门来。输了，会拜入新掌门，并且逐渐拉拢和自己连接的兄弟，一起弃暗投明</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-01-23.png" alt="2020-09-12-18-01-23"></p></li><li><p>情形四：不同门小弟相遇<br>各自拿掌门比较，输了的拜入赢的门派，并且逐渐将与自己连接的兄弟弃暗投明。</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-03-23.png" alt="2020-09-12-18-03-23"></p><p>例如，5 和 4 相遇。虽然 4 的武功好于 5，但是 5 的掌门是 1，比 4 牛，于是 4 拜入 5 的门派。后来当 3 和 4 相遇的时候，3 发现 4 已经叛变了，4 说我现在老大是 1，比你牛，要不你也来吧，于是 3 也拜入 1。</p></li></ol></li></ol><h3 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h3><p>当交换机过多时，虽然 STP 解决了环路问题，避免了广播风暴，但是在同一个局域网中，总有些数据是想在小黑屋里单独交流的，不希望被人给抓包了。</p><p>这时候可以有两个解决方案：</p><ol><li>物理隔离<br>交换机隔离，不在同一个拓扑网络下。</li><li>虚拟隔离 VLAN，也就是常说的虚拟局域网<br>在同一个交换机上形成多个局域网</li></ol><p>交换机如何区分机器属于哪个局域网呢？通过 VLAN ID</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-10-06.png" alt="2020-09-12-18-10-06"></p><p>VLAN 下的网络结构：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-11-16.png" alt="2020-09-12-18-11-16"></p><h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h2><h3 id="ICMP-协议"><a href="#ICMP-协议" class="headerlink" title="ICMP 协议"></a>ICMP 协议</h3><p>ICMP 协议介于网络层和传输层之间，普遍认为属于网络层，ICMP 通常用于 ping 检测网络连通</p><p>ICMP：Internet Control Message Protocol，就是互联网控制报文协议</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-25-18.png" alt="2020-09-12-18-25-18"></p><p>ICMP 报文有很多的类型，不同的类型有不同的代码。最常用的类型是主动请求为 8，主动请求的应答为 0</p><p>报文类型，可以大致分为两类：查询报文 和 差错报文</p><h4 id="查询报文"><a href="#查询报文" class="headerlink" title="查询报文"></a>查询报文</h4><p>ping 就是使用查询报文的一种</p><ul><li>ping 的主动请求，被称为 <strong>ICMP ECHO REQUEST</strong>，类型为 8，</li><li>主动请求的响应，被称为 <strong>ICMP ECHO REPLY</strong>，类型为 0</li></ul><p>比起原生的 ICMP，这里面多了两个字段，一个是<strong>标识符</strong>，另一个是<strong>序号</strong>，在选项数据中，ping 还会存放发送请求的时间，来计算响应时间</p><p>ping 的收发过程：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-12-18-32-03.png" alt="2020-09-12-18-32-03"></p><ol><li>源主机首先会构建一个 ICMP 请求数据包，ICMP 数据包内包含多个字段。</li><li>最重要的是两个，第一个是<strong>类型字段</strong>，对于请求数据包而言该字段为 8；</li><li>另外一个是<strong>顺序号</strong>，主要用于区分连续ping的时候发出的多个数据包。每发出一个请求数据包，顺序号会自动加 1。</li><li>为了能够计算往返时间 RTT，它会在报文的数据部分插入发送时间</li></ol><h4 id="差错报文"><a href="#差错报文" class="headerlink" title="差错报文"></a>差错报文</h4><p>差错报文的类型为有：</p><ul><li>终点不可达，类型为 3<ul><li>网络不可达：代码为 0，对方局域网无响应</li><li>主机不可达：代码为 1，对方局域网响应了，但是找不到这个 ip 对应的主机</li><li>协议不可达：代码为 2，对方主机响应了，但是对方不接受这个协议</li><li>端口不可达：代码为 3，对方主机响应了，但是没有程序监听这个端口</li><li>需要进行分片但设置了不分片：代码为 4，中间某个网关需要对长度进行限制，但是源主机不允许</li></ul></li><li>源站抑制：类型为 4，需要源主机放慢发送速度</li><li>路由重定向：类型为 5，下次发送时发给另一个路由器</li><li>时间超时：类型为 11，超过网络包生命周期还是未到达目标</li></ul><p>差错报文的结构相对复杂一些。除了前面还是 IP，ICMP 的前 8 字节不变，后面则跟上出错的那个 IP 包的 IP 头和 IP 正文的前8 个字节</p><p><strong>Traceroute</strong> 使用差错报文：</p><ol><li>故意设置特殊的 TTL，来追踪去往目的地时沿途经过的路由器</li><li>故意设置不分片，从而确定路径的 MTU</li></ol><p><strong>TTL</strong>：Time To Live。最大值为 255。该字段指定IP包被路由器丢弃之前允许通过的最大网段数量，每个路由器要将 TTL 减1，TTL 通常表示被丢弃前经过的路由器的个数。当 TTL 变为 0 时，该路由器丢弃该包，并发送一个 ICMP 包给最初的发送者</p><h3 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h3><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-10-04-28.png" alt="2020-09-13-10-04-28"></p><p>网关往往是一个路由器，是一个三层（网络层）转发的设备。<br>当服务器 A 需要访问服务器 B 时：</p><ol><li>如果目标 ip 地址是本网段主机，所以直接发给目标主机，封装目标主机的 MAC 地址</li><li>如果目标 ip 地址是外网主机，则将请求发给网关，封装网关的 MAC 地址</li></ol><p>当网关收到了一个请求时</p><ol><li>取下 MAC 头<ol><li>如果 MAC 头不是本主机，则通过转发表将请求转发到本网段其他主机上</li><li>如果 MAC 头是本主机，则取下 IP 头，查看目标 IP 地址<ol><li>如果是本主机，则由本主机程序处理</li><li>如果不是本主机，则查看路由表，查询应该由哪个 LAN 口处理，并封装好下一跳（可能是对应主机，也可能是网关）的 MAC 地址，这时包的 <em>目的 MAC 地址</em> 变为了<strong>路由规则匹配的下一跳的 MAC 地址</strong>，<em>源 MAC 地址</em> 变为了网关的 MAC 地址</li></ol></li></ol></li></ol><p>网关分为两种类型：</p><ul><li>转发网关：<strong>不修改</strong>目标 IP 地址和源 IP 地址的网关</li><li>NAT（Network Address Translation） 网关：<strong>修改</strong>目标 IP 地址和源 IP 地址的网关</li></ul><h4 id="和路由器的关系"><a href="#和路由器的关系" class="headerlink" title="和路由器的关系"></a>和路由器的关系</h4><p>很多情况下，人们把网关就叫作路由器。其实不完全准确，而另一种比喻更加恰当：<strong>路由器是一台设备，它有五个 LAN 网口或者网卡，相当于有五只手，分别连着五个局域网。每只手的 IP 地址都和局域网的 IP 地址相同的网段，每只手都是它握住的那个局域网的网关</strong></p><h4 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h4><p>当网关收到一个外网的请求时，就会通过 <strong>静态路由</strong> 和 <strong>动态路由</strong> 规则修改 MAC 头（和 IP 头），将包发出去</p><p>静态路由，其实就是在路由器上，写死配置一条一条规则。<br>这些规则包括：想访问 BBS 站（它肯定有个网段），从 2 号口出去，下一跳是 IP2；想访问教学视频站（它也有个自己的网段），从 3 号口出去，下一跳是 IP3，然后保存在路由器里</p><h4 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h4><p>网络环境复杂多变时，静态路由手动修改太麻烦，所以需要动态路由通过一定算法进行自动配置</p><p>动态路由算法：</p><ul><li>链路状态路由（link state routing），基于 Dijkstra 算法</li><li>距离矢量路由（distance vector routing），基于 Bellman-Ford 算法，只适用于小型网络</li></ul><p>动态路由协议：</p><ul><li>基于链路状态路由算法的 <strong>OSPF</strong>（Open Shortest Path First，开放式最短路径优先），广泛应用在数据中心中的协议。由于主要用在数据中心内部，用于路由决策，因而称为内部网关协议（Interior Gateway Protocol，简称 IGP）</li><li>基于距离矢量路由算法的 <strong>BGP</strong>（Border Gateway Protocol，边界路由协议）<ul><li>eBGP：在多个 AS（独立的内部网络，如家庭网络） 之间进行路由交换的协议</li><li>iBGP：在多个 edge touter（AS 面向外界的出口路由器） 之间进行路由交换的协议</li></ul></li></ul><h2 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h2><h3 id="UDP-协议"><a href="#UDP-协议" class="headerlink" title="UDP 协议"></a>UDP 协议</h3><p>UDP 协议：数据报协议，不需要接收方确认消息。<br>特点：面向无连接，无状态，不保证不丢失，不保证到达顺序</p><ul><li>优点是速度快</li><li>缺点是可能会丢包</li></ul><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-18-26-14.png" alt="2020-09-13-18-26-14"></p><p>应用场景：</p><ul><li>流媒体，比如直播</li><li>实时游戏</li><li>loT物联网</li><li>移动通信</li><li>需要低时延的 http 访问</li></ul><h3 id="TCP-协议"><a href="#TCP-协议" class="headerlink" title="TCP 协议"></a>TCP 协议</h3><p>TCP 协议：流式 stream 协议，通过双向管道传输数据，发送请求之后必须收到确认消息，安全但效率稍低<br>特点：面向连接，有状态，保证无差错，无重复，并按序到达</p><ul><li>优点是稳定可靠</li><li>缺点是速度较慢，需要维护状态机</li></ul><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-18-39-47.png" alt="2020-09-13-18-39-47"></p><ul><li><p><strong><em>建立连接：</em></strong><br>TCP<strong>三次</strong>握手：</p><ol><li>client 发送管道建立请求(syn)给 server。</li><li>server 同意建立 client 到 server 管道(ack)，及管道建立请求(syn)给 client。</li><li>client 同意建立 server 到 client 管道给 server(ack)。TCP 双向管道连接建立成功</li></ol><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-19-12-26.png" alt="2020-09-13-19-12-26"></p></li><li><p><strong><em>断开连接：</em></strong><br>TCP<strong>四次</strong>挥手：</p><ol><li>client 发送数据<strong>发送</strong>完毕并请求断开管道(FIN)给 server。</li><li>server 同意断开管道(ack)，client 单向断开管道。</li><li>数据接收完毕后，server 发送数据<strong>接收</strong>完毕并请求断开管道(FIN)给 client。</li><li>client 同意断开管道(ack)，server 单向断开管道。TCP 双向管道连接断开</li></ol><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/2020-09-13-19-56-04.png" alt="2020-09-13-19-56-04"></p></li></ul><p>握手和挥手整体流程状态图：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/%E7%BD%91%E7%BB%9C-20200913222940.png" alt="20200913222940"></p><ul><li>加粗的<strong>实线</strong>是客户端 A 的状态变迁，是主要流程<br>其中阿拉伯数字的序号，是握手过程中的顺序<br>而大写中文数字的序号，是挥手过程中的顺序</li><li>加粗的<strong>虚线</strong>是服务端 B 的状态变迁</li><li>点线是非主要流程</li></ul><h4 id="TCP-状态机"><a href="#TCP-状态机" class="headerlink" title="TCP 状态机"></a>TCP 状态机</h4><p>为了实现 TCP 协议的可靠性，TCP 协议规定两端必须实现一个状态机，对每一个发出包与接受包进行记录</p><p>TCP 发送方状态机的数据结构：</p><ul><li>第一部分：发送了并且已经确认的。</li><li>第二部分：发送了并且尚未确认的。</li><li>第三部分：没有发送，但是已经等待发送的。</li><li>第四部分：没有发送，并且暂时还不会发送的。<br>第三部分和第四部分的区别是，接收方会返回给发送方一个窗口大小，表示接收方处理数据的能力大小，叫 <strong>Advertised window</strong>，超过这个窗口大小的包，发送方会暂缓发送</li></ul><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200914080034.png" alt="20200914080034"></p><ul><li>LastByteAcked：第一部分和第二部分的分界线</li><li>LastByteSent：第二部分和第三部分的分界线</li><li>LastByteAcked + AdvertisedWindow：第三部分和第四部分的分界线</li></ul><p>TCP 接收方状态机的数据结构：</p><ul><li>第一部分：接受并且确认过的。</li><li>第二部分：还没接收，但是马上就能接收的。</li><li>第三部分：还没接收，也没法接收的。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200914075917.png" alt="20200914075917"></p><ul><li>LastByteRead：之后是已经接收了，但是还没被应用层读取的；</li><li>NextByteExpected：是第一部分和第二部分的分界线。</li><li>MaxRcvBuffer：最大缓存的量；</li></ul><h4 id="累计应答"><a href="#累计应答" class="headerlink" title="累计应答"></a>累计应答</h4><p>为了保证顺序性，发送方的包都有一个序号，并且按照序号挨个发送。对于接收方，应答却不是挨个应答，会应答一个序号，表示这个序号之前的包都已收到。</p><h4 id="确认与重发机制"><a href="#确认与重发机制" class="headerlink" title="确认与重发机制"></a>确认与重发机制</h4><p>因为底层 IP 协议的不可靠性，无法保证网络包的不丢失与按序到达，TCP 协议自己实现了确认与重发机制来保证顺序问题和丢包问题</p><ol><li>超时重试：对于每一个发送了，但是没有 ACK 的包，都设有一个超时时间，超过时间则重新尝试。<ul><li><strong>超时时间</strong>：是 TCP 通过采样 RTT 的时间，然后进行加权平均算出的，这个值是不断变化的。这个算法被称为<strong>自适应重传算法</strong><br>当一个数据包再次超时时，TCP 的策略是超时间隔加倍。每当遇到一次超时重传的时候，都会将下一次超时时间间隔设为先前值的两倍。两次超时，就说明网络环境差，不宜频繁反复发送</li><li><strong>快速重传</strong>：当接收方收到一个序号大于下一个所期望的序号时，就检测到了数据流中的间隔，于是发送三个冗余的 ACK，发送方收到后就会在超时时间之前提前重传<br>比如，接收方收到了 6、8、9，发现 7 没来，于是发送三个 6 的 ACK。发送方收到 3 个 ACK 后，就会立刻重传 7 的报文</li></ul></li><li>Selective Acknowledgment（SACK）：这种方式需要在 TCP 头里加一个 SACK 的东西，可以将缓存的地图发送给发送方。例如可以发送 ACK6、SACK8、SACK9，有了地图，发送方一下子就能看出来是 7 丢了</li></ol><h4 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h4><ol><li>在每一个包的确认中，都会返回一个 AdvertisedWindow（rwnd） 大小。</li><li>当接受端处理信息过慢时，这个窗口会一直缩减直到 0，发送方就会停止发送。</li><li>这时，发送方会定时发送窗口探测数据包，看窗口是否有空余</li><li>接收方为了避免低能窗口综合征，会在窗口达到一定大小，或者缓冲区一半时才会通知发送方窗口有空余了</li></ol><h4 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h4><p>TCP 的拥塞控制就是在不堵塞，不丢包的情况下，尽量发挥带宽</p><p>拥塞也是通过窗口来控制，这个窗口被称为 cwnd （Congestion Window），有一个公式 LastByteSent - LastByteAcked &lt;= min {cwnd, rwnd} 共同来控制带宽</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916211417.png" alt="TCP 发送接受过程"></p><p>如果一个设备如上图所示，只能同时处理 8 个包，如果再调大窗口，就会出现丢包，不想丢包的话就得在中间设备增加缓存，这样就会增加时延</p><p>TCP 的拥塞控制就是来避免出现上述问题</p><h4 id="BBR-算法"><a href="#BBR-算法" class="headerlink" title="BBR 算法"></a>BBR 算法</h4><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916211957.png" alt="20200916211957"></p><p>TCP 的拥塞控制有两个问题：</p><ol><li>丢包不代表通道已满，有可能是管子本身就漏水。例如公网本身就有丢包问题</li><li>TCP 的拥塞控制会等中间设备的缓存都填充满之后才降速</li></ol><p>BBR 拥塞算法：企图找到一个平衡点，就是通过不断的加快发送速度，将管道填满，但是不要填满中间设备的缓存，因为这样时延会增加，在这个平衡点可以很好的达到高带宽和低时延的平衡</p><h3 id="Socket-接口"><a href="#Socket-接口" class="headerlink" title="Socket 接口"></a>Socket 接口</h3><p>因为 TCP/IP 协议过于复杂，如果程序员每开发一个程序都需要自己处理报文的发送与接受等问题，效率太低了，于是由操作系统封装了一套接口，便于快速处理数据包的发送与接受</p><h4 id="基于-TCP-协议的-Socket"><a href="#基于-TCP-协议的-Socket" class="headerlink" title="基于 TCP 协议的 Socket"></a>基于 TCP 协议的 Socket</h4><p>函数调用过程：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916230544.png" alt="20200916230544"></p><ul><li><p>服务端调用 socket 流程：</p><ol><li>调用 bind 监听 ip 和 端口</li><li>调用 listen 进入监听状态（监听 socket）</li><li>调用 accept，当 TCP 连接成功时，accpet 返回另一个 socket（已连接 socket）进行处理</li><li>和客户端进行通信</li></ol><p>重点：监听的 socket 和通信使用的 socket <strong>不相同</strong>，一个连接对应一个 socket</p></li><li><p>客户端调用 socket 流程：</p><ol><li>调用 connect 连接 ip 和 端口</li><li>和服务端进行通信</li></ol></li></ul><p>socket 在内核中读写过程：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916231334.png" alt="20200916231334"></p><h4 id="基于-UDP-协议的-Socket"><a href="#基于-UDP-协议的-Socket" class="headerlink" title="基于 UDP 协议的 Socket"></a>基于 UDP 协议的 Socket</h4><p>函数调用过程：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200916231723.png" alt="20200916231723"></p><p>UDP 无连接，所以只需要一个 socket 就可以和多个客户端通信，每次通信的时候都会调用 sendto 和 recvfrom，都可以传入 IP 地址和端口</p><h4 id="应用处理-scoket-连接方式"><a href="#应用处理-scoket-连接方式" class="headerlink" title="应用处理 scoket 连接方式"></a>应用处理 scoket 连接方式</h4><p>单体应用可以承载的 socket 连接数是有限的，如何在资源有限的情况下，尽可能多的处理连接</p><ol><li>多进程</li><li>多线程</li><li>IO 复用（select）：一个线程通过 select 轮询的方式检查 socket</li><li>IO 复用（epoll）：采用事件通知的方式</li></ol><h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h2><h3 id="DHCP-协议"><a href="#DHCP-协议" class="headerlink" title="DHCP 协议"></a>DHCP 协议</h3><p>DHCP：Dynamic Host Configuration Protocol，动态主机配置协议</p><p>因为网络中的每一个主机都需要 ip，而在复杂公共环境下，不可能让管理员来手动给每一个设备分配 ip，所以出现了 DHCP。</p><p>DHCP 工作方式：</p><ol><li>新主机使用 0.0.0.0 向 255.255.255.255 发送 DHCP Discover 广播</li><li>DHCP Server 监听到这个广播，判断如果是新主机的话，通过 DHCP Offer 方式将 ip 池里的随机 ip 发送过去（也是广播形式）</li><li>新主机发送 DHCP Request 广播数据包，包中包含客户端的 MAC 地址、接受的租约中的 IP 地址、提供此租约的 DHCP 服务器地址等</li><li>DHCP Server 收到 DHCP Request 后，会返回 DHCP ACK 消息包，表明新主机已被加入网络</li><li>租约达成后，广播通知其他 DHCP Server</li></ol><h3 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h3><p>目前大部分的 HTTP 协议是 1.1，默认开启了 Keep-Alive 的，实现了连接复用</p><p>HTTP 请求的报文格式：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200917075642.png" alt="20200917075642"><br><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E6%9E%84%E6%88%90.png" alt="请求报文"></p><ol><li><p>请求行<br>HTTP 请求常用的请求方法：</p><ol><li>get</li><li>post</li><li>put</li><li>patch</li><li>delete</li></ol></li><li><p>首部<br>常用的 request headers：</p><ol><li>Accept-Type</li><li>Content-Type</li><li>Cache-control</li><li>Last-Modified | If-Modified-Since</li><li>Etag | If-None-Match</li></ol></li><li><p>正文实体</p></li></ol><p>一个完整的 HTTP 请求：</p><p><img src="https://static001.geekbang.org/resource/image/99/49/99c282efaca15deb79c7821c9c577349.jpg" alt="一个完整的 HTTP 请求"></p><h4 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP 2.0"></a>HTTP 2.0</h4><p>HTTP 2.0 为了尝试解决 HTTP 1.1 的实时性、并发性等问题，进行了以下操作：</p><ol><li>对头部进行压缩：将每次都携带的 k-v 结构建立索引，每次只发送索引</li><li>将一个连接切分成多个流</li><li>将所有传输信息分割为更小的帧：header 帧，data 帧</li></ol><p>HTTP 2.0 解决了</p><ol><li>HTTP 1.1 的队首阻塞问题，同时，也不需要通过 HTTP 1.x 的 pipeline 机制用多条TCP连接来实现并行请求与响应；</li><li>减少了 TCP 连接数对服务器性能的影响，同时将页面的多个数据 css、js、 jpg 等通过一个数据链接进行传输，能够加快页面组件的传输速度</li></ol><h3 id="QUIC-协议"><a href="#QUIC-协议" class="headerlink" title="QUIC 协议"></a>QUIC 协议</h3><p>因为 HTTP 协议底层是基于 TCP 协议的，严重依赖于包的串行处理，所以 google 出了一个基于 UDP 的 QUIC 协议，尝试解决 HTTP 的一些问题</p><p>QUIC 的机制：</p><ol><li>自定义连接机制<br>TCP 基于 [源 IP，端口，目的 IP，目的端口] 的四元数组进行连接握手，如果四元数组进行了 wifi 切换等，就会导致重连。<br>QUIC 以一个 64 位的随机数作为 ID 标识，只要 ID 不变，不需要重新连接</li><li>自定义重传机制</li><li>无阻塞的多路复用</li><li>自定义流量控制</li></ol><h3 id="HTTPS-协议"><a href="#HTTPS-协议" class="headerlink" title="HTTPS 协议"></a>HTTPS 协议</h3><p>HTTP 协议在网络中由于是明文信息，容易遭到恶意份子的篡改，所以有了 TLS 协议对其进行加密，保证内容安全。<br>HTTP + TLS = HTTPS</p><p>TLS 加密原理：首先使用非对称加密协商出公钥，然后再使用这个公钥对内容进行对称加密</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920011230.png" alt="20200920011230"></p><ol><li>对称加密：公钥机制，由公钥加密的内容也能由公钥解开</li><li>非对称加密：公私钥机制，只有对应的私钥才能解开公钥加密的内容。服务端公钥的正确性由 CA 证书来保证</li></ol><h3 id="DNS-协议"><a href="#DNS-协议" class="headerlink" title="DNS 协议"></a>DNS 协议</h3><p>在正常的用户上网过程中，用户是不可能能记住每一个网站的 ip 地址的，而且 ip 地址经常会因为 NAT、负载均衡等问题发生改变，这时候我们需要一个方便记忆 ip 的方法，DNS 协议就是当用户使用某个域名（比如 baidu.com）时，获取域名对应的 ip 地址的协议</p><blockquote><p>已知域名，求 IP 的协议</p></blockquote><p>DNS 服务器结构：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920161444.png" alt="20200920161444"></p><p>DNS 递归查询过程：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920224427.png" alt="20200920224427"></p><p>DNS 负载均衡：</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920225045.png" alt="20200920225045"></p><h3 id="HTTPDNS-协议"><a href="#HTTPDNS-协议" class="headerlink" title="HTTPDNS 协议"></a>HTTPDNS 协议</h3><p>传统 DNS 存在以下问题：</p><ol><li>域名缓存：缓存是为了降低递归查询的次数，提高查询效率。<br>但是带来的问题是<ol><li>服务器地址更改后没有及时刷新缓存，导致访问失败</li><li>客户端地址更改后导致全局负载均衡失败，缓存的并不是最优服务器地址</li></ol></li><li>域名转发：权威域名服务器的负载均衡会根据运营商的不同返回不同的服务器地址，但是域名查询由 A 运营商转发给 B 运营商查询，就会导致运营商判断错误</li><li>出口 NAT：NAT 会导致权威域名服务器判断运营商错误</li><li>域名更新：IP 更新后重新解析 DNS 会导致一定时间的延迟乃至服务不可用</li><li>解析延迟：DNS 查询需要递归遍历多个 DNS 服务器，延迟较高</li></ol><p>HTTPDNS 就是<strong>不走传统的 DNS 解析</strong>，而是<strong>应用自己搭建基于 HTTP 协议的 DNS 服务器集群</strong>，分布在多个地点和多个运营商。当客户端需要 DNS 解析的时候，直接通过 HTTP 协议进行请求这个服务器集群，得到就近的地址</p><p><img src="https://cdn.jsdelivr.net/gh/jiz4oh/backups/img/20200920230522.png" alt="20200920230522"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/85">趣谈网络协议</a></p><p><img src="https://static001.geekbang.org/resource/image/79/aa/79adec391c62b8cf90c210804b704daa.jpg" alt="网络协议知识图谱"></p><p><img src="https://img-blog.csdn.net/2018041112053246?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTIxNTU0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="OSI7层协议图谱"></p><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Network_socket">socket</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>jiz4oh</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://jiz4oh.com/2020/11/tcp-ip/" title="TCP&#x2F;IP 五层协议">http://jiz4oh.com/2020/11/tcp-ip/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/think/" rel="tag"># think</a> <a href="/tags/study/" rel="tag"># study</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/10/vim-fast-esc/" rel="prev" title="vim 中使用 esc 切换英文输入"><i class="fa fa-chevron-left"></i> vim 中使用 esc 切换英文输入</a></div><div class="post-nav-item"><a href="/2020/11/receiver-and-ancestors/" rel="next" title="Ruby 是如何调用方法的">Ruby 是如何调用方法的 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments"><script src="https://giscus.app/client.js" data-repo="jiz4oh/jiz4oh.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkyOTg0MTgyNjU=" data-category="Announcements" data-category-id="DIC_kwDOEcmAWc4CTZlo" data-mapping="og:title" data-reactions-enabled="1" data-emit-metadata="1" data-theme="light" data-lang="zh-CN" crossorigin="anonymous" data-input-position="bottom" data-loading="lazy" async></script></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">jiz4oh</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">94k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">2:51</span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="reading-progress-bar"></div><a href="https://github.com/jiz4oh" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="300" alpha="0.6" zindex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.3.0/mermaid.min.js","integrity":"sha256-QdTG1YTLLTwD3b95jLqFxpQX9uYuJMNAtVZgwKX4oYU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script></body></html>